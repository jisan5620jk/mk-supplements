<style>
  .announcement-bar-wrapper {
    background-color: var(--announcement-bg, #D0AC52);
    margin: 0 auto;
    padding: 0 15px;
    max-width: 1440px;
    width: 100%;
    overflow: hidden;
  }
  .announcement-bar-content {
    text-align: center;
    color: #fff;
    font-family: var(--announcement-font, Arial, sans-serif);
    font-weight: 400;
    font-size: var(--announcement-font-size, 1.5rem);
  }

  /* Marquee Animation */
  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  .announcement-marquee {
    white-space: nowrap;
    width: 100%;
  }

  .announcement-marquee-track {
    display: inline-flex;
    animation: marquee var(--marquee-speed, 40s) linear infinite;
    will-change: transform;
  }
  .announcement-marquee-item {
    display: inline-flex;
    align-items: center;
    margin: 0 40px;
    white-space: normal;
    color: #fff;
    font-size: var(--announcement-font-size, 1.25rem);
  }

  /* Swiper Slides */
  .announcement-slider .swiper-slide {
    text-align: center;
    color: #fff;
    font-size: var(--announcement-font-size, 1.25rem);
  }
</style>

<div
  class="announcement-bar-wrapper"
  style="--announcement-bg: {{ section.settings.bg_color }}; --announcement-font-size: {{ section.settings.font_size }}rem;"
>
  {% case section.settings.announcement_animation_type %}
    {% when 'marquee' %}
      <div class="announcement-marquee">
        {% if section.blocks.size > 0 %}
          {% assign blocks_exist = true %}
        {% else %}
          {% assign blocks_exist = false %}
        {% endif %}
        {% for row in (1..3) %}
          <div class="announcement-marquee-track" style="--marquee-speed: {{ section.settings.marquee_speed }}s;">
            {% if blocks_exist %}
              {% for block in section.blocks %}
                <span class="announcement-marquee-item">
                  {{ block.settings.block_text }}
                </span>
              {% endfor %}
            {% else %}
              <span class="announcement-marquee-item">
                <p><strong>SUMMER SALE:&nbsp;</strong>Up to 70%</p>
              </span>
              <span class="announcement-marquee-item">
                <p><strong>FREE </strong>Shipping<strong> </strong>On<strong> ALL </strong>Orders!</p>
              </span>
              <span class="announcement-marquee-item">
                <p><strong>30-day</strong> money-back guarantee</p>
              </span>
            {% endif %}
          </div>
        {% endfor %}
      </div>

    {% when 'slider' %}
      <div class="swiper announcement-slider">
        <div class="swiper-wrapper">
          {% if section.blocks.size > 0 %}
            {% for block in section.blocks %}
              <div class="swiper-slide">
                {{ block.settings.block_text }}
              </div>
            {% endfor %}
          {% else %}
            <div class="swiper-slide">
              <p><strong>SUMMER SALE:&nbsp;</strong>Up to 70%</p>
            </div>
            <div class="swiper-slide">
              <p><strong>FREE </strong>Shipping<strong> </strong>On<strong> ALL </strong>Orders!</p>
            </div>
            <div class="swiper-slide">
              <p><strong>30-day</strong> money-back guarantee</p>
            </div>
          {% endif %}
        </div>
      </div>

    {% when 'only_text' %}
      <div class="announcement-bar-content">
        <p>Subscribe and Get 15% off! â€¢ free shipping across the U.S. on all orders above $100</p>
      </div>
  {% endcase %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const animationType = {{ section.settings.announcement_animation_type | json }};

    if (typeof Swiper !== 'undefined' && animationType === 'slider') {
      const sliderEl = document.querySelector('.announcement-slider');
      if (sliderEl) {
        new Swiper(sliderEl, {
          loop: true,
          grabCursor: true,
          effect: 'fade',
          fadeEffect: {
            crossFade: true
          },
          slidesPerView: {{ section.settings.slides_per_view_large }},
          spaceBetween: {{ section.settings.space_between }},
          autoplay: {
            delay: {{ section.settings.autoplay_delay }},
            disableOnInteraction: false
          },
          speed: {{ section.settings.speed }},
          breakpoints: {
            320: { slidesPerView: {{ section.settings.slides_per_view_small }} },
            640: { slidesPerView: {{ section.settings.slides_per_view_medium }} },
            1024: { slidesPerView: {{ section.settings.slides_per_view_large }} }
          }
        });
      }
    }
  });
</script>

{% schema %}
{
  "name": "Header Announcement Bar",
  "tag": "section",
  "class": "header-announcement",
  "settings": [
    {
      "type": "select",
      "id": "announcement_animation_type",
      "label": "Announcement Animation Type",
      "default": "slider",
      "options": [
        {
          "value": "marquee",
          "label": "Marquee Animation"
        },
        {
          "value": "slider",
          "label": "Slider"
        },
        {
          "value": "only_text",
          "label": "No Animation"
        }
      ]
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#fbbf24"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font Size (rem)",
      "min": 0.5,
      "max": 3,
      "step": 0.1,
      "default": 1.5
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "label": "Marquee Speed (seconds)",
      "min": 5,
      "max": 60,
      "step": 1,
      "default": 40
    },
    {
      "type": "number",
      "id": "slides_per_view_small",
      "label": "Slides per view (mobile)",
      "default": 1
    },
    {
      "type": "number",
      "id": "slides_per_view_medium",
      "label": "Slides per view (tablet)",
      "default": 1
    },
    {
      "type": "number",
      "id": "slides_per_view_large",
      "label": "Slides per view (desktop)",
      "default": 1
    },
    {
      "type": "range",
      "id": "space_between",
      "label": "Space Between Slides",
      "min": 0,
      "max": 50,
      "step": 5,
      "default": 20
    },
    {
      "type": "number",
      "id": "autoplay_delay",
      "label": "Autoplay Delay (ms)",
      "default": 4000
    },
    {
      "type": "number",
      "id": "speed",
      "label": "Transition Speed (ms)",
      "default": 1500
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement Text",
      "settings": [
        {
          "type": "richtext",
          "id": "block_text",
          "label": "Text",
          "default": "<p><strong>SUMMER SALE:&nbsp;</strong>Up to 70%</p>"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Header Announcement Bar",
      "category": "Announcement",
      "settings": {
        "announcement_animation_type": "only_text"
      },
      "blocks": [
        {
          "type": "announcement",
          "settings": {
            "block_text": "<p><strong>SUMMER SALE:&nbsp;</strong>Up to 70%</p>"
          }
        },
        {
          "type": "announcement",
          "settings": {
            "block_text": "<p><strong>FREE </strong>Shipping<strong> </strong>On<strong> ALL </strong>Orders!</p>"
          }
        },
        {
          "type": "announcement",
          "settings": {
            "block_text": "<p><strong>30-day</strong> money-back guarantee</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
